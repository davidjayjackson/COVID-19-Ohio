---
title: "Ohio Covid-19 Report"
author: "David Jackson"
date: "06/08/2021  11:00 AM/EDT"
output: 
  html_document: 
    fig_width: 9
    fig_height: 6
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(scales)
library(dplyr)
library(dlookr)
library(forecast)
library(flextable)
library(RSQLite)
theme_set(theme_linedraw())
```

## Adjusted Numbers for Ohio

```{r}
rm(list=ls())
db <- db <- dbConnect(RSQLite::SQLite(),dbname= "../COVID-19-DB/NYTimes.sqlite3")
df <- dbGetQuery(db,"select date,new_cases,new_deaths from STATESDAILY where state = 'Ohio'")
df$date <- as.Date(df$date)
df <- df[order(df$date),] 
df$new_deaths <- ifelse(df$date =="2021-02-12",mean(df$new_deaths,na.rm = TRUE),df$new_deaths)
df$new_deaths <- ifelse(df$date =="2021-02-13",mean(df$new_deaths,na.rm = TRUE),df$new_deaths)
df$new_deaths <- ifelse(df$date =="2021-02-11",mean(df$new_deaths,na.rm = TRUE),df$new_deaths)
```

### Basic Plots: Cases 

```{r}
df %>% ggplot() + geom_line(aes(x=date,y=new_cases)) +
  scale_y_continuous(labels = comma) +
  labs(title="Ohio Daily Cases (raw data)")

df %>% select(new_cases) %>% diagnose_numeric() %>% flextable()
```

### Basic Plots: Deaths

```{r}
df %>% ggplot() + geom_line(aes(x=date,y=new_deaths)) +
  scale_y_continuous(labels = comma) +
  labs(title="Ohio Daily Deaths (raw data)")

df %>% select(new_deaths) %>% diagnose_numeric() %>% flextable()
```

### Deaths Smoothed using Moving Avearge

```{r}
# Replace Feb. 12/13 with NA
# df$new_deaths <- as.numeric(df$new_deaths)
# df <- dplyr::mutate(
#   df,new_deaths = dplyr::if_else(date >= "2021-02-12" & date <="2021-02-13",70, new_deaths))

```
```{r}
df$MAD <- ma(df$new_deaths,7,centre = TRUE)
buckeye <- df %>% filter(date >="2020-12-01") 
ggplot(buckeye) + geom_line(aes(x=date,y=MAD),lwd=1,col="red") + 
    labs(title="Ohio Deaths ( 7 Day Moving Average)",y="21 Day Moivng Average",
       x="Dates Starting with Dec  1,2020") + ylim(0,150) +
  geom_smooth(aes(x=date,y=MAD),method="glm")
  
```
```{r}
df$MAC <- ma(df$new_cases,7,centre = TRUE)
buckeye <- df %>% filter(date >="2020-12-01") 
ggplot(buckeye) + geom_line(aes(x=date,y=MAC),lwd=1,col="red") +
  labs(title="Ohio Cases (7 Day Moving Average)",y="21 Day Moivng Average",
       x="Dates Starting with Dec. 1,2020") +
  geom_smooth(aes(x=date,y=MAC),method="glm")

```
## Looking closer at the numbers for Feb 7 - 17

```{r}
df %>% filter(date >="2021-02-07" & date <= "2021-02-14") %>% ggplot(aes(x=date,y=new_deaths)) + geom_col()
```

