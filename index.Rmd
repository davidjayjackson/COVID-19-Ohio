---
title: "Ohio Covid-19 Report"
author: "David Jackson"
date: "`r Sys.time()`"
output: 
  html_document: 
    fig_width: 9
    fig_height: 6
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(scales)
library(dplyr)
library(dlookr)
library(forecast)
library(flextable)
library(RSQLite)
library(timetk)
library(pracma)
theme_set(theme_linedraw())
```

## Adjusted Numbers for Ohio

```{r}
rm(list=ls())
db <- db <- dbConnect(RSQLite::SQLite(),dbname= "../COVID-19-DB/NYTimes.sqlite3")
df <- dbGetQuery(db,"select date,new_cases,new_deaths from STATESDAILY where state = 'Ohio'")
df$date <- as.Date(df$date)
df <- df[order(df$date),] 
```
```{r}
df %>% filter(date >="2021-02-07" & date <= "2021-02-14") %>% ggplot(aes(x=date,y=new_deaths)) + geom_col() +
  labs(title ="Before Adjustments")
```
```{r}
df$new_deaths <- ifelse(df$date =="2021-02-12",mean(df$new_deaths,na.rm = TRUE),df$new_deaths)
df$new_deaths <- ifelse(df$date =="2021-02-13",mean(df$new_deaths,na.rm = TRUE),df$new_deaths)
df$new_deaths <- ifelse(df$date =="2021-02-11",mean(df$new_deaths,na.rm = TRUE),df$new_deaths)
```

## Looking closer at the numbers for Feb 7 - 17

```{r}
df %>% filter(date >="2021-02-07" & date <= "2021-02-14") %>% ggplot(aes(x=date,y=new_deaths)) + geom_col() +
  labs(title = "After Adjustments")
```

### Basic Plots: Deaths

```{r}

df$MAD <- movavg(df$new_deaths,7,type="e")
buckeye <- df %>% filter(date >="2020-10-01") 
ggplot(buckeye) + geom_line(aes(x=date,y=MAD),lwd=1,col="red") + 
    labs(title="Ohio Deaths ( 7 Day Moving Average)",y="21 Day Moivng Average",
       x="Dates Starting with Dec  1,2020") + ylim(0,150) +
  geom_smooth(aes(x=date,y=MAD),method="glm")
  
df %>% select(new_deaths) %>% diagnose_numeric() %>% flextable()
```
```{r}
df %>% group_by(date) %>%
  summarise_by_time(date,.by = "week",Deaths =sum(new_deaths)) %>%
  ggplot() + geom_col(aes(x=date,y=Deaths,col="Deaths"),lwd=2) +
  labs(title = "Ohio Covid-19 Deaths by Week")
```



### Basic Plots: Cases 


```{r}
df$MAC <- movavg(df$new_cases,7,type = "e")
buckeye <- df %>% filter(date >="2020-10-01") 
ggplot(buckeye) + geom_col(aes(x=date,y=new_cases),lwd=1,col="red") +
  labs(title="Ohio Cases (+ Loess fitted Curve)",y="Lowaa Fitted Curve",
       x="Dates Starting with Dec. 1,2020") +
  geom_smooth(aes(x=date,y=new_cases),method="loess",span = 0.25)

df %>% select(new_cases) %>% diagnose_numeric() %>% flextable()
```




```{r}
buckeye <- df %>% filter(date >="2020-10-01") 
ggplot(buckeye) + geom_col(aes(x=date,y=new_deaths),lwd=1,col="red") +
  labs(title="Ohio Deaths (Loess,span = 0.2)",y="21 Day Moivng Average",
       x="Dates Starting with Dec. 1,2020") +
  geom_smooth(aes(x=date,y=new_deaths),span = 0.2) + ylim(0,250)

```
```{r}
df %>% group_by(date) %>%
  summarise_by_time(date,.by = "week",Cases =sum(new_cases)) %>%
  ggplot() + geom_col(aes(x=date,y=Cases,col="Cases"),lwd=2) +
  labs(title = "Ohio Covid-19 Cases by Week")
```
