---
title: "Ohio COVID-19 Daily Report"
author: "David Jackson"
date: "04/08/2021 1:30 PM/EDT"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,message = FALSE,error = FALSE)
library(ggplot2)
library(scales)
library(RSQLite)
library(dplyr)
library(forecast)
theme_set(theme_linedraw() + theme(panel.grid = element_line(linetype = 'dashed')))
```
## Big New's About Ohio's Covid-19 Deaths.(2021-02-12)
* "Ohio health dept. to restructure after 4K unreported deaths"
* Source: https://wpta21.com/2021/02/12/governor-expected-to-discuss-underreported-covid-19-deaths/
Summary: Ohio "un·der·re·ported" Covid-19 Deaths  by as much  4,000
Thursday’s daily coronavirus death toll showed more than 720 deaths, of which 650 come from previously unreported deaths, GOP Gov. Mike DeWine said.(2021-02-11)
"The Health Department said that “process issues affecting the reconciliation and reporting of these deaths” began in October, with most occurring in November and December"

* lwaananenjones Github: Ohio (2021-03-29)
That's correct — Ohio is no longer announcing deaths on a daily schedule. At the beginning of March, the state transitioned to a different system for tallying deaths based on death certificates. Here is a portion from the state's March 2 press release:

* In addition, mortality data will no longer be reported daily. Updated death certificate data is typically sent to the Ohio Department of Health twice per week, and may lag – often 1-2 months, but up to 6 months. On dates that data is not reported to the Ohio Department of Health, deaths will remain static on the COVID-19 dashboards. For the foreseeable future, mortality information will not be updated on specific days of the week. Case and other data will continue to be reported through ODRS on its current schedule.

* Added 40 Deaths to new_deaths1 for the period of 2020-10-01 - 2020-12-31
* Estimated daily deaths for Feb. 12 to be 800, and Feb. 13 to be 850
```{r}
### State Data
rm(list=ls())
db <- db <- dbConnect(RSQLite::SQLite(),dbname= "../COVID-19-DB/NYTimes.sqlite3")
df <- dbGetQuery(db,"select * from STATESDAILY")
df$date <- as.Date(df$date)
df <- df[order(df$date),]
df <- subset(df,state =="Ohio" & date >="2020-03-10" )
df$TotalCases <- as.numeric(df$TotalCases)
df$TotalDeaths <- as.numeric(df$TotalDeaths)
df$new_cases <- as.numeric(df$new_cases)
df$new_deaths <- as.numeric(df$new_deaths)
```
```{r}
# Fix Fouth Quarter Deaths
df <- dplyr::mutate(
  df,new_deaths1 = dplyr::if_else(date >= "2020-10-01" & date <="2020-12-31",new_deaths + 40, new_deaths))

```


```{r}
sum(df$new_cases,na.rm=TRUE)
sum(df$new_deaths1,na.rm=TRUE)
## County Data
DF <- dbGetQuery(db,"select date,state,county,new_cases,new_deaths from  COUNTYDAILY where state='Ohio'")
DF$date <- as.Date(DF$date)
# str(DF$date)
```



#### Mortality Rate by Date

```{r}
# ggplot(df) + geom_line(aes(x=date,y=death_rate)) +
#   scale_y_continuous(labels=percent) +
#   geom_hline(yintercept = 0.025,col="red") +
#   ylim(0,0.3)

```

#### Daily COVID19 Cases and Deaths

```{r}
df$MAC <- ma(df$new_cases,21,centre=TRUE)
df$MAD <- ma(df$new_deaths1,21,centre=TRUE)

ggplot(df,aes(x=date,y=MAC)) + geom_area(lwd=1,col="red") +
    labs(title="Ohio Daily COVID19 Cases by Date",
         subtitle = "(21 Day Moving Average)") 
  

ggplot(df,aes(x=date,y=MAD)) + geom_area(lwd=1,col="red") +
    labs(title="Ohio Daily COVID19 Deaths by Date",
         subtitle = "(21 Day Moving Average/ y-limit:0,100)") +
  ylim(0,150)
```



#### Weekly and Monthly Cases and Deaths

```{r}
df$Monthly <- as.Date(cut(df$date,
  breaks = "month"))
df$Weekly <- as.Date(cut(df$date,
  breaks = "week",
  start.on.monday = FALSE))
```
```{r}
Weekly_new_cases <- aggregate(new_cases~Weekly,df,FUN=sum)
Weekly_new_deaths <- aggregate(new_deaths~Weekly,df,FUN=sum)

```
```{r}
ggplot(Weekly_new_cases,aes(x=Weekly,y=new_cases)) + geom_area() +
  geom_smooth(span=0.25,se=FALSE) + labs(title="Weekly COVID19 Cases")

ggplot(Weekly_new_deaths,aes(x=Weekly,y=new_deaths)) + geom_area() +
  geom_smooth(span=0.25,se=FALSE) + labs(title="Weekly COVID19 Deaths") +
  ylim(0,1000)
```
```{r}
monthly_new_cases <- aggregate(new_cases~Monthly,df,FUN=sum)
monthly_new_deaths <- aggregate(new_deaths~Monthly,df,FUN=sum)
```
```{r}
ggplot(monthly_new_cases,aes(x=Monthly,y=new_cases)) + geom_col() +
  labs(title="Monthly COVID19 Cases")

ggplot(monthly_new_deaths,aes(x=Monthly,y=new_deaths)) + geom_col() +
   labs(title="Monthly COVID19 Deaths")
```

### Top Five Counties Based on Daily Totals for Previous 8 Days

```{r}
# df <- subset(df,date ==Sys.Date() -8 )
# Top <- df[order(df$new_cases,decreasing = TRUE),]
# Top5 <-top_n(df,5,new_cases)
# ggplot(Top5,aes(x=new_cases,y=county)) +
#   geom_col() + coord_flip() +
#   labs(title="Top 5 Counties by Total Cases for last 7 day.")
# 
# df <- subset(df,date ==Sys.Date() -8 )
# Top <- df[order(df$new_cases,decreasing = TRUE),]
# Top5 <-top_n(df,5,new_cases)
# ggplot(Top5,aes(x=new_cases,y=county)) +
#   geom_col() + coord_flip() +
#   labs(title="Top 5 Counties by Total Cases for last 7 day.")



```

### Plot of Franklin Country Daily Cases and Deaths

```{r}
# df %>% filter(county =="Franklin") %>%
# ggplot(aes(x=date,y=new_cases)) + geom_line() +
#   geom_smooth(span=0.25) +
#   labs(title="Franklin County Cases by Date")
# 
# df(county =="Franklin") %>%
# ggplot(aes(x=date,y=new_deaths)) + geom_line() +
#   geom_smooth(span=0.25) +
#   labs(title="Franklin County Deaths by Date") + ylim(0,20)
```




