---
title: "Ohio COVID-19 Daily Report"
author: "David Jackson"
date: "11/05/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(scales)
library(RSQLite)
```

```{r}
### State Data
rm(list=ls())
source("../DATA/movavg.R")
db <- db <- dbConnect(RSQLite::SQLite(),dbname= "../COVIDDB/COVID.sqlite3")
df <- dbGetQuery(db,"select * from STATESDAILY")
df <- df[order(df$date,decreasing = TRUE),]
df <- subset(df,state =="Ohio" & date >="2020-03-10" )
df$date <- as.Date(df$date)
mean(df$new_cases)
mean(df$new_deaths)

## County Data
## County Data
DF <- dbGetQuery(db,"select date,state,county,new_cases,new_deaths from  COUNTYDAILY where state='Ohio'")
DF$date <- as.Date(DF$date)
str(DF$date)
```

#### Daily COVID19 Cases and Deaths


```{r}
US <- subset(df,date >="2020-04-01")
ggplot(US,aes(x=date,y=new_cases)) + geom_line() +
  geom_smooth(span=0.25) +
  labs(title="Ohio Daily COVID19 Cases by Date")

ggplot(US,aes(x=date,y=new_deaths)) + geom_line() +
  geom_smooth(span=0.25) +
  labs(title="Ohio Daily COVID19 Deaths by Date")
```

#### Weekly and Monthly Cases and Deaths

```{r}
US$Monthly <- as.Date(cut(US$date,
  breaks = "month"))
US$Weekly <- as.Date(cut(US$date,
  breaks = "week",
  start.on.monday = FALSE))
```
```{r}
Weekly_new_cases <- aggregate(new_cases~Weekly,US,FUN=sum)
Weekly_new_deaths <- aggregate(new_deaths~Weekly,US,FUN=sum)

```
```{r}
ggplot(Weekly_new_cases,aes(x=Weekly,y=new_cases)) + geom_col() +
  geom_smooth(span=0.25) + labs(title="Weekly COVID19 Cases")

ggplot(Weekly_new_deaths,aes(x=Weekly,y=new_deaths)) + geom_col() +
  geom_smooth(span=0.25) + labs(title="Weekly COVID19 Deaths")
```
```{r}
monthly_new_cases <- aggregate(new_cases~Monthly,US,FUN=sum)
monthly_new_deaths <- aggregate(new_deaths~Monthly,US,FUN=sum)
```
```{r}
ggplot(monthly_new_cases,aes(x=Monthly,y=new_cases)) + geom_col() +
  labs(title="Monthly COVID19 Cases")

ggplot(monthly_new_deaths,aes(x=Monthly,y=new_deaths)) + geom_col() +
   labs(title="Monthly COVID19 Deaths")
```

### Top Five Counties Based on Daily Totals for Previous 8 Days

```{r}
df <- subset(DF,date ==Sys.Date() -8 )
Top <- df[order(df$new_cases,decreasing = TRUE),]
Top5 <-head(Top,n=5)
ggplot(Top5,aes(x=new_cases,y=county)) +
  geom_col() + coord_flip() +
  labs(title="Top 5 Counties by Total Cases for last 7 day.")

Top5 <-head(Top,n=5)
ggplot(Top5,aes(x=new_deaths,y=county)) +
  geom_col() + coord_flip() +
  labs(title="Top 5 Counties by Total Deaths for last 7 day.")
```

### Plot of Franklin Country Daily Cases and Deaths

```{r}
franklin <- subset(DF,DF$county =="Franklin")
ggplot(franklin,aes(x=date,y=new_cases)) + geom_line() +
  geom_smooth(span=0.25) +
  labs(title="Franklin County Cases by Date")

franklin <- subset(DF,DF$county =="Franklin")
ggplot(franklin,aes(x=date,y=new_deaths)) + geom_line() +
  geom_smooth(span=0.25) +
  labs(title="Franklin County Deaths by Date")
```